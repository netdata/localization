# 数据采集精度

为了更好地监测系统并诊断应用运行中出现的问题，在数据统计时使用更高的时间精度是非常有必要的。

## 为什么要选择Netdata？

- 世界正在不断地发展。如今，客户的体验受到服务器响应时间的影响，因此，SLA比以往更加紧凑。因此，使用刷新率为10秒的监控器来监控2秒的SLA是不切实际的。

- IT服务正在变得虚拟化。与真实硬件不同，虚拟机环境不是稳定的，也不可以被预测。当你的服务需要资源时，你不能指望资源马上可用。虚拟环境的延迟受许多因素的影响，其中大多数的因素我们都无法控制，例如：主机托管商的维护策略，运行在相同物理服务器上的虚拟机的工作负载以及资源分配和限制虚拟机之间的策略，主机提供商供应的系统等。

## 其他服务商为什么不这样做？

那么，为什么大多数监控平台和 SaaS 提供商都不提供高刷新率的监控指标？

他们想这样做，但他们无法这样做，至少不是大规模的推广。

其原因在于他们的设计：

1. 时间序列数据库（prometheus，graphite，opentsdb，Influxdb等）集中了所有的监控指标。从规模上看，这些数据库很容易成为整个基础架构的瓶颈。

2. SaaS 提供商将其业务模型建立在指标的基础之上。除了时间序列数据库的瓶颈之外，它们还增加了带宽的成本。因此，大规模的支持高刷新率指标将会破坏他们的商业模式。

当然，大多数的服务商已经解决了这些问题：不是按比例放大，横向扩展。也就是说，他们不是通过投资更好的硬件，而是通过将服务分散，以便通过向其添加更多更小的节点来扩展它。

现在已经有许多服务商尝试解决这个问题。但到目前为止，所有的解决方案都需要集中的测试。因此，虽然问题以某种方式得到解决，但它仍然是所有监控平台的关键问题，也是监控成本增加的关键原因之一。

另一个重要的因素是运行时数据有效的收集方式。大多数的解决方案都无法完美地完成。数据收集会在运行时消耗大量的系统资源，在很大程度上影响受监控的系统和应用程序。

最后，收集每秒的数据是很困难的。繁忙的虚拟环境有 [大约100ms的固定延迟，随机分布到所有数据源](https://docs.google.com/presentation/d/18C8bCTbtgKDWqPa57GXIjB2PbjjpjsUNkLtZEz6YK8s/edit#slide=id.g422e696d87_0_57)。如果未正确地收集数据，则此延迟会引入上下 10％ 的随机误差，这对于监控系统而言是非常重要的。

因此，监控行业未能大规模提供高刷新率的指标，主要有以下三个原因：

1. 指标的集中化收集使得监控成本在该刷新率中效率低下。
2. 数据的收集方式需要优化，否则会显著影响被监控的系统或程序。
3. 数据的收集很困难，特别是在繁忙的虚拟环境中。

## Netdata有什么同的做法？

Netdata 把监控分散了。每个 Netdata 节点都是独立的。它在本地收集指标，在本地存储它们，然后对它们进行检查并在本地发出警报，从而为仪表板提供 API 使数据可视化。这允许 Netdata 被无限地扩展。

当然，Netdata 可以在需要时集中储存指标。例如，在分散节点上保存数据是不切实际的。对于这些情况来说，Netdata 实时地收集、传输数据，从分散节点传输到附近的一个或多个中心节点。这些数据会在集中后被再次分发。在大型的基础设施上，可能存在着许多个中心点。

为了消除繁忙的虚拟环境中数据收集延迟导致的误差，Netdata 会对收集的指标进行插值。它使用每秒数据源的微秒时序来执行此操作，提供错误率为 0.0001% 的测量。当 Netdata 运行时，其会收集每个数据点，并确保数据库正常工作并具有可接受的精确度（参考文档：[在调试模式下，Netdata 会计算这个误差率](https://github.com/netdata/netdata/blob/36199f449852f8077ea915a3a14a33fa2aff6d85/database/rrdset.c#L1070-L1099)）。

最后，Netdata 的运行速度非常地快。优化是本产品的核心任务。在现代的硬件上，Netdata 每秒可以收集每个核心超过1万个指标（包括所有内容，比如：解析数据源，插入数据，数据库的读/写等）。但是，对于每个节点每秒几万个的数据，Netdata 却仅仅需要可以忽略不计的CPU资源（仅占用每个核心的 1% ~ 2％）。

Netdata的设计旨在：
- 解决集中化数据监控的问题。
- 替代控制台进行性能故障排除。

因此，对于 Netdata 来说，做到以秒级单位的数据监控是非常容易的，这是也很自然的结果。

[![analytics](https://www.google-analytics.com/collect?v=1&aip=1&t=pageview&_s=1&ds=github&dr=https%3A%2F%2Fgithub.com%2Fnetdata%2Fnetdata&dl=https%3A%2F%2Fmy-netdata.io%2Fgithub%2Fdocs%2Fwhy-netdata%2F1s-granularity&_u=MAC~&cid=5792dfd7-8dc4-476b-af31-da2fdb9f93d2&tid=UA-64295674-3)]()
